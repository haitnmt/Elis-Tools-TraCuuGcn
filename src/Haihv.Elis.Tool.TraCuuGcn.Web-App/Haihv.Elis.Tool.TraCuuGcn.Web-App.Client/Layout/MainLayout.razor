@inherits LayoutComponentBase
@attribute [StreamRendering]
@* Required *@
<MudThemeProvider/>
<MudPopoverProvider/>
@* Needed for dialogs *@
<MudDialogProvider/>

@* Needed for snackbars *@
<MudSnackbarProvider/>
<MudThemeProvider @ref="@_mudThemeProvider" @bind-IsDarkMode="@_isDarkMode"/>

@if (_isInitialized)
{
    <MudLayout>
        <MudAppBar>
            <MudAvatar Class="mr-2">
                <MudImage Src="./logo.png"></MudImage>
            </MudAvatar>
            <MudHidden Breakpoint="Breakpoint.SmAndDown">
                <MudText Typo="Typo.h6">
                    Tra cứu thông tin Giấy chứng nhận
                </MudText>
            </MudHidden>
            <MudHidden Breakpoint="Breakpoint.MdAndUp">
                <MudStack Spacing="0">
                    <MudText Typo="Typo.subtitle2">
                        Tra cứu thông tin
                    </MudText>
                    <MudText Typo="Typo.subtitle2">
                        Giấy chứng nhận
                    </MudText>
                </MudStack>
            </MudHidden>
            <MudSpacer/>
            <LogInOrOut/>
            <MudToggleIconButton @bind-Toggled="@_isDarkMode"
                                 Icon="@Icons.Material.Filled.DarkMode"
                                 Color="@Color.Error"
                                 Size="Size.Small"
                                 title=@(_isDarkMode ? "On" : "Off")
                                 ToggledIcon="@Icons.Material.Filled.LightMode" ToggledColor="@Color.Default"/>
            <MudIconButton
                Icon="@Icons.Custom.Brands.GitHub"
                Size="Size.Small"
                Color="Color.Inherit"
                Href="@UrlGitHub"
                Target="_blank"/>
        </MudAppBar>
        <MudMainContent>
            <AuthorizeView>
                <Authorized>
                    @Body
                </Authorized>
                <NotAuthorized>
                    <MudStack Class="mt-2 mx-2 mb-16" 
                              Style="height: calc((1 / 3)*(100vh - 50px))"
                              Justify="Justify.FlexEnd">
                        <MudGrid Justify="Justify.Center">
                            <MudItem xs="12" sm="8" md="6" lg="4" xl="3" xxl="2">
                                <MudAlert Variant="Variant.Outlined" Severity="Severity.Warning">
                                    <MudText>
                                        Vui lòng đăng nhập trước khi sử dụng!
                                    </MudText>
                                    <MudButton Color="Color.Warning" Href="/authentication/login">
                                        Đăng nhập
                                    </MudButton>
                                </MudAlert>
                            </MudItem>
                        </MudGrid>
                    </MudStack>
                </NotAuthorized>
            </AuthorizeView>
        </MudMainContent>
        <MudAppBar Bottom="true" Dense="true" Color="Color.Dark">
            <MudText Typo="Typo.caption">
                © @(DateTime.Today.Year) vpdkbacninh.vn | haihv.vn
            </MudText>
            <MudSpacer/>
            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudHidden Breakpoint="Breakpoint.SmAndDown">
                    <Version/>
                </MudHidden>
                <About/>
            </MudStack>
        </MudAppBar>
    </MudLayout>
}
else
{
    <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Style="height: 100vh">
        <MudProgressCircular Color="Color.Primary" Size="Size.Medium" Indeterminate="true"/>
        <MudAlert Severity="Severity.Info" Dense="true">
            <MudText Typo="Typo.body2">Đang khởi tạo...</MudText>
        </MudAlert>
    </MudStack>
}



<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div>

